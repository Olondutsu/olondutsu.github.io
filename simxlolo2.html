<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Mini-jeu</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: #ddd;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .game-container {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,0.2);
      width: fit-content;
    }

    .grid-wrapper {
      display: grid;
      grid-template-columns: 60px repeat(4, 80px);
      grid-template-rows: 60px repeat(4, 80px);
      gap: 0;
      position: relative;
    }

    .btn-top, .btn-left {
      background: darkred;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      margin: auto;
      cursor: pointer;
      transition: transform 0.2s;
      border: 2px solid black;
    }

    .btn-top:hover, .btn-left:hover {
      transform: scale(1.1);
    }

    .cell {
      width: 80px;
      height: 80px;
      border: 1px solid #333;
      position: relative;
    }

    .cell img {
      max-width: 60px;
      max-height: 60px;
      position: absolute;
      top: 10px;
      left: 10px;
    }

    .highlight-col {
      background: rgba(255, 0, 0, 0.2);
    }

    .highlight-row {
      background: rgba(0, 0, 255, 0.2);
    }

    .sprite {
      width: 60px;
      height: 60px;
      position: absolute;
      z-index: 10;
      transition: all 0.2s linear;
    }

  </style>
</head>
<body>

<div class="game-container">
  <div class="grid-wrapper" id="grid">
    <!-- Top buttons -->
    <div></div>
    <div class="btn-top" data-type="col" data-index="0"></div>
    <div class="btn-top" data-type="col" data-index="1"></div>
    <div class="btn-top" data-type="col" data-index="2"></div>
    <div class="btn-top" data-type="col" data-index="3"></div>

    <!-- Rows -->
    <!-- For each row, left button + 4 cells -->
    ${[0,1,2,3].map(row => `
      <div class="btn-left" data-type="row" data-index="${row}"></div>
      ${[0,1,2,3].map(col => `
        <div class="cell" data-row="${row}" data-col="${col}">
          <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/70/Emoji_u1f4b0.svg/1024px-Emoji_u1f4b0.svg.png" style="display:none;">
        </div>
      `).join('')}
    `).join('')}
  </div>
</div>

<script>
  const grid = document.getElementById('grid');
  const cells = document.querySelectorAll('.cell');
  let clickCounts = {};

  // Highlight function
  function clearHighlights() {
    document.querySelectorAll('.cell').forEach(cell => {
      cell.classList.remove('highlight-col', 'highlight-row');
    });
  }

  function highlight(index, type) {
    clearHighlights();
    document.querySelectorAll('.cell').forEach(cell => {
      if (type === 'col' && cell.dataset.col == index) {
        cell.classList.add('highlight-col');
      }
      if (type === 'row' && cell.dataset.row == index) {
        cell.classList.add('highlight-row');
      }
    });
  }

  function createSprite() {
    const sprite = document.createElement('img');
    sprite.src = 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/e5/Emoji_u1f426.svg/1024px-Emoji_u1f426.svg.png';
    sprite.className = 'sprite';
    return sprite;
  }

  function launchMovement(index, type, speed) {
    const sprite = createSprite();
    const path = [];

    if (type === 'col') {
      for (let r = 0; r < 4; r++) {
        const cell = document.querySelector(`.cell[data-row="${r}"][data-col="${index}"]`);
        path.push(cell);
      }
    } else {
      for (let c = 0; c < 4; c++) {
        const cell = document.querySelector(`.cell[data-row="${index}"][data-col="${c}"]`);
        path.push(cell);
      }
    }

    document.body.appendChild(sprite);

    let i = 0;
    function move() {
      if (i >= path.length) {
        sprite.remove();
        return;
      }
      const rect = path[i].getBoundingClientRect();
      sprite.style.left = rect.left + 10 + 'px';
      sprite.style.top = rect.top + 10 + 'px';

      // simulate piece collection
      const img = path[i].querySelector('img');
      if (img && img.style.display !== 'none') {
        img.style.display = 'none'; // "collect"
      }

      i++;
      setTimeout(move, 400 / speed); // faster speed = shorter delay
    }

    move();
  }

  // Button logic
  document.querySelectorAll('.btn-top, .btn-left').forEach(btn => {
    const index = btn.dataset.index;
    const type = btn.dataset.type;
    const key = type + index;

    clickCounts[key] = 0;

    btn.addEventListener('click', () => {
      clickCounts[key] = (clickCounts[key] + 1) % 4;
      if (clickCounts[key] === 0) return; // reset, no move

      const speed = clickCounts[key];
      highlight(index, type);
      spawnCoins(); // reset coins randomly
      launchMovement(index, type, speed);
    });
  });

  function spawnCoins() {
    cells.forEach(cell => {
      const img = cell.querySelector('img');
      img.style.display = Math.random() < 0.5 ? 'block' : 'none';
    });
  }
</script>

</body>
</html>
